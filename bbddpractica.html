<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>BBDD Practica</title>
    <link rel="icon" type="image/x-icon" href="recursos/favicon.ico">
</head>

<body>
    <h1>BBDD Practica</h1>
    <h2>No debe estar creada la base de datos</h2>
    <h2>Ver consola</h2>
    <hr />

    <button onclick="crearIndicesBD();">Crear índices en los almacenes</button>

    <br /><br />

    <textarea id="info" cols="120" rows="20"></textarea>

    <script type="text/javascript">
        var peticion, bd, almacenPersonas, almacenCoches, almacenCiudades;

        function mensaje(texto) {
            document.getElementById("info").value += "\n\n" + texto;
        }


        var peticion, bd, almacenAlbum;

        if (window.indexedDB) {
            peticion = window.indexedDB.open("musica", 1);

            peticion.onsuccess = function(evento) {
                //Escribir el código para realizar consultas, inserciones, etc...(DML)
                mensaje("EVENTO: success\nSe ha abierto correctamente la base de datos: " + peticion.result.name + " con versión " + peticion.result.version);

                bd = peticion.result;
                var transaccion = bd.transaction(bd.objectStoreNames, "readwrite");

                almacenAlbum = transaccion.objectStore("album");
                /*almacenAlbum.put({
                    nombre: "La Miel de las Flores Muertas",
                    fecha: "2020"
                });*/
            };

            peticion.onerror = function(evento) {
                alert("No se ha creado la base de datos: " + event.target.errorCode);
            };

            peticion.onupgradeneeded = function(evento) {
                //Escribir el código para crear o modificar la estructura de la BD (DDL)
                //Recordatorio: Este evento sólo se ejecuta si se abre la base de datos con una versión nueva superior

                mensaje("EVENTO: upgradedneeded\nSe modifica la versión o es nueva");
                bd = peticion.result;

                /* Creación e Inserción tuplas almacenAlbum */
                almacenAlbum = bd.createObjectStore("album", {
                    keyPath: "id",
                    autoIncrement: true
                });
                almacenAlbum.put({
                    nombre: "La Miel de las Flores Muertas",
                    fecha: "2020"
                });
                almacenAlbum.put({
                    nombre: "La Teoría del Fuego",
                    fecha: "2016"
                });
                almacenAlbum.put({
                    nombre: "Buen Viaje",
                    fecha: "2014"
                });
                almacenAlbum.put({
                    nombre: "Inercia",
                    fecha: "2012"
                });
                almacenAlbum.put({
                    nombre: "Miseria, Sangre y Plomo",
                    fecha: "2010"
                });
                almacenAlbum.put({
                    nombre: "Con el Viento de Cara",
                    fecha: "2008"
                });
                almacenAlbum.put({
                    nombre: "Agujero social",
                    fecha: "2004"
                });
                almacenAlbum.put({
                    nombre: "Gritando en silencio",
                    fecha: "2005"
                });
                almacenAlbum.put({
                    nombre: "Antártida",
                    fecha: "2018"
                });

                mensaje("SE CREAN LOS ÍNDICES");

                almacenAlbum.createIndex("por_id", "id", {
                    unique: true
                });
                almacenAlbum.createIndex("por_nombre", "nombre");
                almacenAlbum.createIndex("por_fecha", "fecha");
            };

        }
    </script>
</body>

</html>